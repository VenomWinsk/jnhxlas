(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b7105b4e"],{"25f0":function(e,t,r){"use strict";var a=r("6eeb"),l=r("825a"),s=r("d039"),o=r("ad6d"),i="toString",n=RegExp.prototype,u=n[i],c=s((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),p=u.name!=i;(c||p)&&a(RegExp.prototype,i,(function(){var e=l(this),t=String(e.source),r=e.flags,a=String(void 0===r&&e instanceof RegExp&&!("flags"in n)?o.call(e):r);return"/"+t+"/"+a}),{unsafe:!0})},"5a64":function(e,t,r){},ba9b:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"rule"},["list"===e.pageType?r("div",{staticClass:"ruleList"},[r("div",{staticClass:"tableTopTools clearfix"},[r("p",{staticClass:"toolName fl"},[e._v("工具栏：")]),r("div",{staticClass:"buttons fl"},[r("a-button",{attrs:{type:"primary"},on:{click:e.optrule}},[r("a-icon",{attrs:{type:"plus"}}),e._v("添加规则 ")],1)],1)]),r("div",{staticClass:"tableContent"},[r("a-table",{attrs:{columns:e.columns,dataSource:e.ruleData,rowKey:"id",pagination:!1},on:{change:e.onSortChange},scopedSlots:e._u([{key:"ruleGroupId",fn:function(t,a){return r("span",{},[r("span",[e._v(e._s(e._f("getRuleGroupCnById")(a.ruleGroupId,e.that)))])])}},{key:"gmtCreate",fn:function(t,a){return r("span",{},[r("span",[e._v(e._s(e._f("dateFormatter")(a.gmtCreate,1)))])])}},{key:"gmtModified",fn:function(t,a){return r("span",{},[r("span",[e._v(e._s(e._f("dateFormatter")(a.gmtModified,1)))])])}},{key:"action",fn:function(t,a){return r("span",{},[r("a",{staticClass:"t-optColor-normal",on:{click:function(t){return e.editRule(a)}}},[e._v("编辑")]),r("a",{staticClass:"t-optColor-warning",on:{click:function(t){return e.deleterule(a)}}},[e._v("删除")]),r("a",{staticClass:"t-optColor-success"},[e._v("详情")])])}}],null,!1,1444796207)}),e.ruleData.length>0?r("div",{staticClass:"ar",staticStyle:{"margin-top":"30px"}},[r("a-pagination",{attrs:{total:e.total,"page-size":e.pageParam.size},on:{change:e.pageChange},model:{value:e.pageParam.page,callback:function(t){e.$set(e.pageParam,"page",t)},expression:"pageParam.page"}})],1):e._e()],1)]):e._e(),"add"===e.pageType||"edit"===e.pageType?r("div",{staticClass:"ruleOpt"},[r("ruleOpt")],1):e._e(),"detail"===e.pageType?r("div",{staticClass:"ruleDetail"},[r("ruleDetail")],1):e._e()])},l=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"rule-opt"},[r("div",{staticClass:"buttons"},[r("a-button",{attrs:{type:"primary"},on:{click:e.back}},[r("a-icon",{attrs:{type:"arrow-left"}}),e._v(" 返回 ")],1)],1),r("div",{staticClass:"optContent"},[r("p",{staticClass:"partTitle"},[e._v("添加 / 编辑规则信息")]),r("div",{staticClass:"partContent"},[r("a-form-model",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.ruleFormRule}},[r("a-row",{attrs:{gutter:[24,24]}},[r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:8,xl:12}},[r("a-form-model-item",{attrs:{label:"规则名称",prop:"name"}},[r("a-input",{attrs:{placeholder:"请输入规则名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:8,xl:12}},[r("a-form-model-item",{attrs:{label:"所属规则组",prop:"ruleGroupId"}},[r("a-select",{attrs:{placeholder:"请选择规则组",allowClear:""},model:{value:e.ruleForm.ruleGroupId,callback:function(t){e.$set(e.ruleForm,"ruleGroupId",t)},expression:"ruleForm.ruleGroupId"}},e._l(e.ruleGroupData,(function(t){return r("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name)+" ")])})),1)],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"行为类别",prop:"category"}},[r("a-input",{attrs:{placeholder:"用于标注日志属性"},model:{value:e.ruleForm.category,callback:function(t){e.$set(e.ruleForm,"category",t)},expression:"ruleForm.category"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"日志特征",prop:"logFeature"}},[r("a-input",{attrs:{placeholder:"用于选择应用本规则的日志 形如login，若无可不填"},model:{value:e.ruleForm.logFeature,callback:function(t){e.$set(e.ruleForm,"logFeature",t)},expression:"ruleForm.logFeature"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"日志数据",prop:"logData"}},[r("a-input",{attrs:{placeholder:"请输入一条日志数据"},model:{value:e.ruleForm.logData,callback:function(t){e.$set(e.ruleForm,"logData",t)},expression:"ruleForm.logData"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"提取规则表达式",prop:"extractRule"}},[r("a-input",{attrs:{placeholder:"用于提取字段，形如 %{IPV4>>ip},%{DATA>>result}"},model:{value:e.ruleForm.extractRule,callback:function(t){e.$set(e.ruleForm,"extractRule",t)},expression:"ruleForm.extractRule"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"转换规则表达式",prop:"switchRule"}},[r("a-input",{attrs:{placeholder:"对提取字段进一步处理，形如 ip:$getGeo>>country,city"},model:{value:e.ruleForm.switchRule,callback:function(t){e.$set(e.ruleForm,"switchRule",t)},expression:"ruleForm.switchRule"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"替换规则表达式",prop:"replaceRule"}},[r("a-input",{attrs:{placeholder:"对提取字段进一步处理，形如 result==succeed>>result=success"},model:{value:e.ruleForm.replaceRule,callback:function(t){e.$set(e.ruleForm,"replaceRule",t)},expression:"ruleForm.replaceRule"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"补充规则表达式",prop:"supplementRule"}},[r("a-input",{attrs:{placeholder:"用于补充字段，形如:{“type”:“http”,“opt”:“login”}"},model:{value:e.ruleForm.supplementRule,callback:function(t){e.$set(e.ruleForm,"supplementRule",t)},expression:"ruleForm.supplementRule"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:12,xl:24}},[r("a-form-model-item",{attrs:{label:"规则描述",prop:"description"}},[r("a-textarea",{attrs:{placeholder:"请输入规则描述",rows:"4"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1)],1),r("a-col",{staticStyle:{padding:"0 12px 12px"},attrs:{xxl:24,xl:24}},[r("a-form-model-item",{attrs:{label:"是否启用",prop:"isEnabled"}},[r("a-switch",{model:{value:e.ruleForm.isEnabled,callback:function(t){e.$set(e.ruleForm,"isEnabled",t)},expression:"ruleForm.isEnabled"}})],1)],1)],1)],1),r("div",{staticClass:"submitButton ar"},[r("a-button",{staticStyle:{"margin-right":"20px",width:"120px"},attrs:{type:"primary"},on:{click:e.testRules}},[e._v("测试")]),r("a-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:e.save}},[r("a-icon",{attrs:{type:"save"}}),e._v(" 保存 ")],1)],1),e.tabelFlag?r("div",{staticStyle:{overflow:"auto"}},[r("a-table",{attrs:{id:"textTable",columns:e.columns,dataSource:e.expressionData,pagination:!1}})],1):e._e()],1)])])},o=[],i=(r("d81d"),r("b64b"),r("d3b7"),r("25f0"),r("5530")),n=r("2f62"),u={name:"rule-opt",computed:Object(i["a"])({},Object(n["b"])(["ruleGroupData"])),data:function(){return{ruleForm:{name:"",ruleGroupId:"",category:"",logFeature:"",logData:"",extractRule:"",switchRule:"",replaceRule:"",supplementRule:"",description:"",isEnabled:!0},ruleFormRule:{name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],ruleGroupId:[{required:!0,message:"请选择规则组",trigger:"change"}],category:[{required:!0,message:"请选择行为类别",trigger:"blur"}],logData:[{required:!0,message:"请输入日志数据",trigger:"blur"}],extractRule:[{required:!0,message:"请输入提取规则表达式",trigger:"blur"}]},pageType:"",tabelFlag:!1,columns:[],expressionData:[]}},methods:{back:function(){this.$router.push({name:"rule",query:{pageType:"list"}})},save:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return e.$message.warning("输入有误，请检查"),!1;if(""!==e.ruleForm.extractRule&&e.$fun.regularRules(e.ruleForm.extractRule))e.$message.warning("提取表达式 >>后面不能是数字，请正确填写");else{var r,a=!0;try{r=e.ruleForm.supplementRule?JSON.parse(e.ruleForm.supplementRule):"",r&&"[object Object]"!==Object.prototype.toString.call(r)&&(a=!1,e.$message.warning("补充表达式输入格式有误，请正确填写"))}catch(o){return a=!1,void e.$message.warning("补充表达式输入有误，请正确填写")}if(a){var l={src_str:e.ruleForm.logData,extract_rule:e.ruleForm.extractRule,switch_rule:e.ruleForm.switchRule,replace_rule:e.ruleForm.replaceRule,supplement:""===r?{}:r,testFilePaths:"",testFilrRule:"",flag:!1},s=Object.assign({},e.ruleForm,{isEnabled:e.ruleForm.isEnabled?1:0});"add"===e.pageType?e.$API.test_rule(l).then((function(t){Array.isArray(t)&&t.length>0?e.$API.addRule(s).then((function(t){1e3===t.code?(e.$message.success("添加规则成功"),e.back()):e.$message.warning(t.message)})):t.error?e.$message.error(t.error):0===t.length&&e.$message.error("出现异常,缺少提取语句或赋值语句")})).catch((function(t){console.log(t),e.$message.error("表达式测试服务异常，请联系管理员")})):(Object.assign(s,{id:e.ruleForm.id,testFilePaths:"",testFilrRule:"",flag:!1}),e.$API.test_rule(l).then((function(t){Array.isArray(t)&&t.length>0?e.$API.editRule(s).then((function(t){1e3===t.code?(e.$message.success("编辑规则成功"),e.back()):e.$message.warning(t.message)})):t.error?e.$message.error(t.error):0===t.length&&e.$message.error("出现异常,缺少提取语句或赋值语句")})).catch((function(t){console.log(t),e.$message.error("表达式测试服务异常，请联系管理员")})))}}}))},testRules:function(){var e=this;this.tabelFlag=!0,this.$refs.ruleForm.validate((function(t){if(!t)return e.$message.warning("输入有误，请检查"),!1;if(""!==e.ruleForm.extractRule&&e.$fun.regularRules(e.ruleForm.extractRule))e.$message.warning("提取表达式 >>后面不能是数字，请正确填写");else{var r,a=!0;try{r=e.ruleForm.supplementRule?JSON.parse(e.ruleForm.supplementRule):"",r&&"[object Object]"!==Object.prototype.toString.call(r)&&(a=!1,e.$message.warning("补充表达式输入格式有误，请正确填写"))}catch(o){return a=!1,void e.$message.warning("补充表达式输入有误，请正确填写")}if(a){var l={src_str:e.ruleForm.logData,extract_rule:e.ruleForm.extractRule,switch_rule:e.ruleForm.switchRule,replace_rule:e.ruleForm.replaceRule,supplement:""===r?{}:r,testFilePaths:"",testFilrRule:"",flag:!1},s=Object.assign({},e.ruleForm,{isEnabled:e.ruleForm.isEnabled?1:0});"add"===e.pageType?e.$API.test_rule(l).then((function(t){Array.isArray(t)&&t.length>0?e.$API.addRule(s).then((function(t){1e3===t.code?(e.$message.success("添加规则成功"),e.back()):e.$message.warning(t.message)})):t.error?e.$message.error(t.error):0===t.length&&e.$message.error("出现异常,缺少提取语句或赋值语句")})).catch((function(t){console.log(t),e.$message.error("表达式测试服务异常，请联系管理员")})):(Object.assign(s,{id:e.ruleForm.id,testFilePaths:"",testFilrRule:"",flag:!1}),e.$API.test_rule(l).then((function(t){Array.isArray(t)&&t.length>0?(e.columns=Object.keys(t[0]).map((function(e){return{dataIndex:e,title:e}})),e.expressionData=t):t.error?e.$message.error(t.error):0===t.length&&e.$message.error("出现异常,缺少提取语句或赋值语句")})).catch((function(t){console.log(t),e.$message.error("表达式测试服务异常，请联系管理员")})))}}}))}},created:function(){var e=this;this.pageType=this.$route.query.pageType,"edit"===this.pageType&&this.$API.getRuleByRuleId(this.$route.query.id).then((function(t){1e3===t.code&&(e.ruleForm=Object.assign({},t.data,{isEnabled:!!e.ruleForm.isEnabled}))}))}},c=u,p=(r("f8c3"),r("2877")),d=Object(p["a"])(c,s,o,!1,null,null,null),m=d.exports,g={name:"rule",components:{ruleOpt:m,ruleDetail:m},data:function(){return{columns:[{dataIndex:"name",title:"规则名称",sorter:!0},{dataIndex:"category",title:"行为类型"},{dataIndex:"logFeature",title:"日志特征"},{dataIndex:"ruleGroupId",title:"所属规则组",scopedSlots:{customRender:"ruleGroupId"}},{dataIndex:"description",title:"规则描述",ellipsis:!0},{dataIndex:"creator",title:"创建者"},{dataIndex:"gmtCreate",title:"创建时间",scopedSlots:{customRender:"gmtCreate"},sorter:!0},{dataIndex:"gmtModified",title:"最近更新时间",scopedSlots:{customRender:"gmtModified"}},{dataIndex:"action",title:"操作",scopedSlots:{customRender:"action"}}],ruleData:[],ruleVisible:!1,content:{category:"",ruleGroupId:"",extractRule:"",switchRule:"",replaceRule:"",supplementRule:"",description:"",isEnabled:1,creator:"",gmtCreate:"",gmtModified:"",order:"desc",field:""},optType:0,pageType:"list",pageParam:{page:1,size:10},searchInput:"",total:0,that:this}},created:function(){this.getRule(),this.$store.dispatch("getRuleGroupData",this),this.pageType=this.$route.query.pageType||"list"},watch:{$route:{handler:function(){this.pageType=this.$route.query.pageType||"list","list"===this.pageType&&this.getRule()},deep:!0}},methods:{getRule:function(){var e=this;this.field&&(this.pageParam.field=this.field),this.order&&(this.pageParam.order=this.order),this.$API.searchRule(this.pageParam).then((function(t){1e3===t.code?(e.ruleData=t.data,e.total=t.total,e.pageParam.page>1&&0===e.ruleData.length&&(e.pageParam.size--,e.getRule())):e.ruleData=[]}))},optrule:function(){this.$router.push({name:"rule",query:{pageType:"add"}})},editRule:function(e){this.$router.push({name:"rule",query:{pageType:"edit",id:e.id}})},deleterule:function(e){var t=this.$createElement,r=this;this.$confirm({title:"确定删除该条数据吗？",content:function(){return t("div",{style:"color:red"},["删除后将不可恢复"])},okText:"确认删除",cancelText:"取消删除",onOk:function(){r.$API.delRule(e.id).then((function(e){1e3===e.code?(r.$message.success("删除成功"),r.getRule()):r.$message.warning(e.message)}))}})},ruleOk:function(e){var t=this;if(e.optType){var r=Object.assign({},e.formContent,{id:this.content.id});this.$API.editRule(r).then((function(e){1e3===e.code?(t.$message.success("规则更新成功"),t.ruleVisible=!1,t.getRule()):t.$message.warning(e.message)}))}else this.$API.addRule(e.formContent).then((function(e){1e3===e.code?(t.$message.success("添加规则成功"),t.ruleVisible=!1,t.getRule()):t.$message.warning(e.message)}))},ruleCancel:function(){this.ruleVisible=!1},pageChange:function(){this.getRule()},onSortChange:function(e,t,r){"ascend"===r.order?r.order="asc":"descend"===r.order&&(r.order="desc"),"gmtCreate"===r.field&&(r.field="gmt_create"),this.page=1,this.order=r.order,this.field=r.field,this.getRule()}}},f=g,h=Object(p["a"])(f,a,l,!1,null,null,null);t["default"]=h.exports},f8c3:function(e,t,r){"use strict";var a=r("5a64"),l=r.n(a);l.a}}]);
//# sourceMappingURL=chunk-b7105b4e.4df67c2e.js.map