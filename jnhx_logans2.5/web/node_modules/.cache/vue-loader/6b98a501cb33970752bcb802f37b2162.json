{"remainingRequest":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/hx_ygg/job/hx_logana3.0/web/src/views/collect/inTask/in-task.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/home/hx_ygg/job/hx_logana3.0/web/src/views/collect/inTask/in-task.vue","mtime":1631238422177},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hx_ygg/job/hx_logana3.0/web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5pbl90YXNrIHsKCWhlaWdodDogY2FsYygxMDAlIC0gNTBweCk7CglvdmVyZmxvdy15OiBhdXRvOwp9Cg=="},{"version":3,"sources":["in-task.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuSA;AACA;AACA;AACA","file":"in-task.vue","sourceRoot":"src/views/collect/inTask","sourcesContent":["<template>\n\t<div class=\"in_task\">\n\t\t<Card>\n\t\t\t<my-table\n\t\t\t\t:column=\"tableConfig.column\"\n\t\t\t\t:data=\"tableConfig.data\"\n\t\t\t\t:tools=\"tableConfig.tools\"\n\t\t\t\t:page=\"tableConfig.page\"\n\t\t\t\t:frontPage=\"true\"\n\t\t\t\t:total=\"tableConfig.data.length\"\n\t\t\t\t@page-change=\"pageChange\"\n\t\t\t\tv-if=\"mode === 0\"\n\t\t\t>\n\t\t\t\t<template #buttons>\n\t\t\t\t\t<Button type=\"info\" @click=\"projectVisible = true\">\n\t\t\t\t\t\t<Icon type=\"md-create\" /> 添加入库\n\t\t\t\t\t</Button>\n\t\t\t\t</template>\n\t\t\t\t<template #unit_id=\"{ row }\">\n\t\t\t\t\t{{ getUnitById(row.unit) }}\n\t\t\t\t</template>\n\t\t\t\t<template #pro_status=\"{ row }\">\n\t\t\t\t\t{{ getStatusByCode(row.pro_status) }}\n\t\t\t\t</template>\n\t\t\t\t<template #action=\"{ row }\">\n\t\t\t\t\t<Button type=\"warning\" size=\"small\" @click=\"del(row)\">\n\t\t\t\t\t\t删除 </Button\n\t\t\t\t\t>&nbsp;\n\t\t\t\t\t<Button type=\"success\" size=\"small\" @click=\"toDetail(row)\"\n\t\t\t\t\t\t>详情</Button\n\t\t\t\t\t>\n\t\t\t\t</template>\n\t\t\t</my-table>\n\t\t\t<div class=\"detail\" v-if=\"mode === 1\">\n\t\t\t\t<div class=\"back\">\n\t\t\t\t\t<Button type=\"primary\" @click=\"back\"\n\t\t\t\t\t\t><Icon type=\"md-arrow-round-back\" />返回</Button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<expand-row :row=\"currentData\" @statusChange=\"statusChange\"></expand-row>\n\t\t\t</div>\n\t\t</Card>\n\t\t<Modal\n\t\t\tv-model=\"projectVisible\"\n\t\t\ttitle=\"添加入库\"\n\t\t\t:mask-closable=\"false\"\n\t\t>\n\t\t\t<Form :model=\"inParam\" :rules=\"inParamRule\" ref=\"inParam\">\n\t\t\t\t<FormItem label=\"项目名称\" prop=\"pro_name\">\n\t\t\t\t\t<Input\n\t\t\t\t\t\tv-model=\"inParam.pro_name\"\n\t\t\t\t\t\tplaceholder=\"输入项目名称\"\n\t\t\t\t\t></Input>\n\t\t\t\t</FormItem>\n\t\t\t\t<FormItem label=\"单位\" prop=\"unit_id\">\n\t\t\t\t\t<Select v-model=\"inParam.unit\">\n\t\t\t\t\t\t<Option\n\t\t\t\t\t\t\t:value=\"unit.unit_id\"\n\t\t\t\t\t\t\t:key=\"unit.unit_id\"\n\t\t\t\t\t\t\tv-for=\"unit of unitData\"\n\t\t\t\t\t\t\t>{{ unit.unit_name }}</Option\n\t\t\t\t\t\t>\n\t\t\t\t\t</Select>\n\t\t\t\t</FormItem>\n\t\t\t\t<FormItem label=\"文件路径\" prop=\"data_path\">\n\t\t\t\t\t<Input\n\t\t\t\t\t\tv-model=\"inParam.data_path\"\n\t\t\t\t\t\tplaceholder=\"文件夹路径\"\n\t\t\t\t\t\tstyle=\"width: calc(100% - 20px)\"\n\t\t\t\t\t></Input>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\ttype=\"md-checkmark-circle\"\n\t\t\t\t\t\tstyle=\"font-size: 18px; color: green\"\n\t\t\t\t\t\tv-if=\"folderSuccess\"\n\t\t\t\t\t/>\n\t\t\t\t</FormItem>\n                <FormItem label=\"任务描述\" prop=\"pro_description\">\n                        <Input\n                            v-model=\"inParam.pro_description\"\n                            placeholder=\"请输入任务描述信息\"\n                            type=\"textarea\"\n                            :rows=\"4\"\n                        ></Input>\n                    </FormItem>\n\t\t\t</Form>\n            <div slot=\"footer\">\n                <Button type=\"default\" @click=\"cancel\">取消</Button>\n                <Button type=\"primary\" @click=\"save\">确定</Button>\n            </div>\n\t\t</Modal>\n\t</div>\n</template>\n<script>\nimport myTable from '@/components/mytable/my-table.vue';\nimport { getProcess, createPro, validatePath, delProcess } from '@/api/collect';\nimport { getUnit } from '@/api/setting';\nimport { projStatus } from './status';\nimport ExpandRow from './expandRow.vue';\nexport default {\n\tcomponents: { myTable, ExpandRow },\n\tname: 'in-task',\n\tdata() {\n\t\tconst validateFolders = (rule, value, callback) => {\n\t\t\tif (!value) {\n\t\t\t\treturn callback(new Error('文件路径不得为空！'));\n\t\t\t}\n\t\t\t// 模拟异步验证效果\n\t\t\t// setTimeout(() => {\n\t\t\t// \tif (value === 'a/b/c') {\n\t\t\t// \t\tcallback();\n\t\t\t// \t\tthis.folderSuccess = true;\n\t\t\t// \t} else {\n\t\t\t// \t\tcallback(new Error('文件路径检测不到！'));\n\t\t\t// \t}\n            // }, 1000);\n            validatePath(value).then(res => {\n                if(!!res){\n                    callback();\n\t\t\t\t\tthis.folderSuccess = true;\n\t\t\t\t} else {\n\t\t\t\t\tcallback(new Error('文件路径不存在！'));\n\t\t\t\t}\n            })\n\t\t};\n\t\treturn {\n\t\t\ttableConfig: {\n\t\t\t\tdata: [],\n\t\t\t\tcolumn: [\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'pro_name',\n\t\t\t\t\t\ttitle: '任务名称',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'unit_id',\n\t\t\t\t\t\ttitle: '所属单位',\n\t\t\t\t\t\tslot: 'unit_id',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'pro_status',\n\t\t\t\t\t\ttitle: '任务状态',\n\t\t\t\t\t\tslot: 'pro_status',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'data_path',\n\t\t\t\t\t\ttitle: '文件路径',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'pro_description',\n\t\t\t\t\t\ttitle: '任务描述',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '操作',\n\t\t\t\t\t\tslot: 'action',\n\t\t\t\t\t\tkey: 'action',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttools: [],\n\t\t\t\tpage:1\n\t\t\t},\n\t\t\tprojectVisible: false,\n\t\t\tinParam: {\n\t\t\t\tpro_name: '',\n\t\t\t\tdata_path: '',\n\t\t\t\tunit: null,\n\t\t\t\tpro_description: '',\n\t\t\t},\n\t\t\tinParamRule: {\n\t\t\t\tpro_name: [\n\t\t\t\t\t{\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tmessage: '请输入项目任务名称',\n\t\t\t\t\t\ttrigger: 'blur',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdata_path: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalidator: validateFolders,\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\ttrigger: 'blur',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\tfolderSuccess: false,\n\t\t\tmode: 0,\n\t\t\tcurrentData: {},\n\t\t\tunitData: [],\n\t\t\tprojStatus,\n\t\t};\n\t},\n\tmounted() {\n\t\tthis.getUnit();\n\t\tthis.getProcess();\n\t},\n\tcomputed: {\n\t\tgetUnitById() {\n\t\t\treturn function (id) {\n\t\t\t\treturn this.unitData.find((list) => list.unit_id === id)\n\t\t\t\t\t.unit_name;\n\t\t\t};\n\t\t},\n\t\tgetStatusByCode() {\n\t\t\treturn function (code) {\n\t\t\t\treturn this.projStatus.find((list) => list.code === code)\n\t\t\t\t\t.status;\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\t// 获取所有单位数据\n\t\tgetUnit() {\n\t\t\tgetUnit().then((res) => {\n\t\t\t\tthis.unitData = res;\n\t\t\t});\n\t\t},\n\t\t// 获取所有任务信息\n\t\tgetProcess() {\n\t\t\tgetProcess().then((res) => {\n\t\t\t\tthis.tableConfig.data = res;\n\t\t\t});\n\t\t},\n\t\tdel(row) {\n            let that = this;\n            this.$Modal.confirm({\n                title:'是否删除该条数据',\n                onOk:function(){\n                    delProcess(row.pro_id).then(() => {\n                        that.$Message.success('删除成功');\n                        that.getProcess();\n                    })\n                }\n            })\n\t\t},\n\t\tcancel() {\n\t\t\tthis.projectVisible = false;\n\t\t\tthis.folderSuccess = false;\n\t\t\tthis.resetForm();\n\t\t},\n\t\tresetForm() {\n\t\t\tthis.inParam = {\n\t\t\t\tpro_name: '',\n\t\t\t\tdata_path: '',\n\t\t\t\tunit_id: null,\n\t\t\t\tpro_description: '',\n\t\t\t};\n\t\t},\n\t\ttoDetail(row) {\n\t\t\tthis.currentData = Object.assign(\n\t\t\t\t{},\n\t\t\t\trow,\n\t\t\t\t{ unit_name: this.getUnitById(row.unit) },\n\t\t\t\t{ statusStr: this.getStatusByCode(row.pro_status) }\n\t\t\t);\n\t\t\tthis.mode = 1;\n        },\n        // 校验\n        validatorPath(path){\n            return new Promise(resolve => {\n                validatePath(path).then((res) => {\n                    resolve(res)\n                })\n            })\n        },\n\t\tback() {\n            this.mode = 0;\n            this.getUnit();\n\t\t    this.getProcess();\n\t\t},\n\t\tsave(){\n            this.$refs['inParam'].validate((valid) => {\n                if(valid){\n                    createPro(this.inParam).then(() => {\n                        this.getProcess();\n                        this.projectVisible = false;\n                    })\n                } else {\n                    this.$Message.warning('校验输入有误')\n                }\n            })\n        },\n        statusChange(data){\n            this.currentData = Object.assign(\n\t\t\t\t{},\n                this.currentData,\n                data,\n\t\t\t\t{ unit_name: this.getUnitById(data.unit) },\n\t\t\t\t{ statusStr: this.getStatusByCode(data.pro_status) }\n\t\t\t);\n        },\n\t\tasync pageChange(page) {\n\t\t\tthis.tableConfig.page = page;\n\t\t},\n\t},\n};\n</script>\n<style lang=\"scss\">\n.in_task {\n\theight: calc(100% - 50px);\n\toverflow-y: auto;\n}\n</style>\n"]}]}